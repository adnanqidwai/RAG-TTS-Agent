# Backend for the Harmony Tutor

The backend is a FASTAPI server that serves the Harmony Tutor.
It serves the following endpoints:

- `/retrieve?query=...` - Retrieves a concatenated string of top 5 results for the query, which match in the vector database. 
- `/rag?query=...` - Performs Retrieval Augmented Generation on the query and returns the generated text from the model.
- `/agent?query=...` - Takes decisions based on the query and returns the response from the agent.
- `/tts` - Takes text as input and returns the base64 audio string of the text, using the API provided by Sarvam.

## Running the server
To run the server, run the following command:
```bash
uvicorn main:app --reload
```
This will start the server on `http://localhost:8000`. You can change the port by changing the port number in the `main.py` file.

## Implementation

### Storage
We first store the PDF(s) in a directory called _pdfs_. Then, we check if the pdf collection is already present in the database. If not, we add the text using PyPDF2 and ChromaDB, embedding through the default `all-MiniLM-L6-v2` model which generates 384 size embeddings for each sentence. We then store the embeddings in the database.

### Retrieval
With a given query, we first embed the query using the same model and then find the top 10 results from the database using ChromaDB's _query()_ method.
Using the list of top 5 results, we then return a concatenated string of the top 5 results.

### RAG
With a given query, we retrieve the top 5 results from the database using the same method as above. We then pass the query as the question and the concatenated result list as context to the RAG model, which generates the response.

### Agent
The agent utilises a decision model with history to decide the response based on the query. 
The response can be utilised from one of the following tools:
- `rag` - The response is generated using the RAG model.
- `smalltalk` - The response is a generic greeting generated by the model.
- `sound_calculator` - The response is generated by calculating a missing value in a wave problem. For example, calculating the frequency of a wave, given the wavelength and speed of the wave.
- `unknown` - The query is unknown and hence, the response is that the model cannot generate a response.

### TTS
The TTS endpoint takes text as input and returns the base64 audio string of the text. This is done using the API provided by Sarvam.
